<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="font-mono bg-white flex flex-col h-screen items-center p-4">

  <!-- Editable area -->
  <div id="pad"
       contenteditable="true"
       class="p-4 whitespace-pre-wrap outline-none text-gray-900 overflow-auto h-[60%] flex-1 w-full">Type or paste anything here...</div>

  <!-- Bottom control panel -->
  <div id="panel"
       class="bottom-0 left-0 w-full shadow-lg bg-white text-base p-4 h-fit">
    
    <h1 class="text-2xl font-black">tabNotes</h1>
    <div class="text-gray-800">
      This is a local scratchpad. Type anything. Closing or refreshing will ask “sure?” if auto download is enabled.
    </div>

    <!-- Filename input -->
    <div class="flex items-center mt-2">
      <input
        id="filename"
        type="text"
        placeholder="local_tabnote_<DATE_SAVED>"
        class="flex-grow px-4 py-2 text-base border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
      >
    </div>

    <!-- Auto-download toggle -->
    <div class="flex items-center mt-2">
      <input checked id="autoDl" type="checkbox" class="w-4 h-4 border border-gray-300 rounded bg-white focus:ring-2 focus:ring-blue-500">
      <label for="autoDl" class="select-none ms-2 text-sm font-medium text-gray-800">
        Auto download when navigating away from page
      </label>
    </div>

    <!-- Manual download button -->
    <button id="downloadBtn"
      class="mt-2 px-6 py-2 text-base font-semibold text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
      Download notes
    </button>

    <div class="mt-2 flex align-center">
      Built by Taq Karim with
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor"
           class="ml-1 mt-1 text-pink-500" viewBox="0 0 16 16">
        <path fill-rule="evenodd"
              d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314">
        </path>
      </svg>
    </div>

  </div>

<script>
(function () {
  const pad       = document.getElementById("pad");
  const filename  = document.getElementById("filename");
  const autoDl    = document.getElementById("autoDl");
  const downloadBtn = document.getElementById("downloadBtn");

  // Default filename prefix
  filename.value = "local_tabnote";

  function makeFilename() {
    const base = filename.value.trim() || "local_tabnote";
    const timestamp = new Date().toISOString();
    return base + "_" + timestamp + ".txt";
  }

  function saveFile(name, content) {
    const blob = new Blob([content], { type: "text/plain" });
    const url  = URL.createObjectURL(blob);
    const a    = document.createElement("a");
    a.href = url;
    a.download = name;
    a.click();
    URL.revokeObjectURL(url);
  }

  // Manual download
  downloadBtn.addEventListener("click", () => {
    const content = pad.textContent;
    saveFile(makeFilename(), content);
  });

  // Auto-download on unload
  window.addEventListener("beforeunload", (e) => {
    if (autoDl.checked) {
      saveFile(makeFilename(), pad.textContent);
    }
    const message = "sure?";
    e.preventDefault();
    e.returnValue = message;
    return message;
  });

    document.addEventListener('DOMContentLoaded', () => {
        const editableDiv = document.getElementById('pad');
        if (editableDiv) { // Check if the element exists
            const range = document.createRange();
            range.selectNodeContents(editableDiv);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
        }
    });

})();
</script>

</body>
</html>

